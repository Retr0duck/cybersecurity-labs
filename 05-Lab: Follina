# Laboratory: Follina (CVE-2022-30190) Exploit

Welcome to the **Follina Lab**. In this exercise, you will analyze the Follina vulnerability, a critical remote code execution (RCE) flaw in Microsoft Office, and investigate how attackers exploit it through phishing and document manipulation.

---

## Overview

- **Follina** (CVE-2022-30190) is a zero-day vulnerability affecting Microsoft Office products.
- Allows attackers to execute arbitrary code via the MSDT protocolâ€”even with macros disabled.
- Attackers commonly deliver malicious payloads through phishing emails and document previews.

---

## Lab Files

**Warning:**  
This lab includes a sample malicious file (`file.doc`) for educational analysis. **Do NOT open** it with Microsoft Office or enable macros.

---

## Objectives

- Understand the mechanism of the Follina exploit.
- Identify key indicators of compromise (IOCs) for Follina.
- Analyze attack delivery methods and payload execution.
- Learn effective mitigation and response strategies.

---

## Technical Details

- **CVE:** [CVE-2022-30190](https://nvd.nist.gov/vuln/detail/CVE-2022-30190)
- **Discovery:** Zero-day disclosed May 27, 2022. First known exploitation: April 7, 2022.
- **Attack Vector:** Phishing campaigns lure users into opening malicious Office documents.
- **Exploit Mechanism:**
  - The document contains an external reference to a malicious URL (e.g., `hxxp://xxx.xx.xxx.xx/color.html`).
  - When opened, even in Protected View, Office invokes the MSDT protocol to run attacker-controlled PowerShell commands.
  - Payload is fetched and executed, compromising the system.

---

## Lab Steps

1. **File Type Analysis**
    ```bash
    file file.doc
    ```

2. **Extract External References**
    - Use `strings` or a hex editor to find URLs or MSDT references:
      ```bash
      strings file.doc | grep -i "http"
      strings file.doc | grep -i "ms-msdt"
      ```

3. **Identify Payload**
    - Locate PowerShell commands or suspicious scripts:
      ```bash
      strings file.doc | grep -i "powershell"
      ```

4. **Review Indicators of Compromise**
    - Check for network calls to unknown IPs/domains.
    - Inspect for MSDT protocol usage.

5. **Mitigation Recommendations**
    - Patch and update Microsoft Office.
    - Disable MSDT protocol (see [Microsoft guidance](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-30190)).
    - Educate users about phishing risks.

---

## Analysis Questions

1. **What is the external URL used by the exploit?**
2. **How does the document trigger code execution without macros?**
3. **Which protocol is leveraged for RCE in this attack?**
4. **What are the key IOCs for Follina?**
5. **How can organizations mitigate this vulnerability?**

---

## References

- [Microsoft Official Guidance](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-30190)
- [LogRhythm: Detecting Follina](https://logrhythm.com)
- [Infosec Resources: Follina Exploit](https://resources.infosecinstitute.com)
- [BeyondTrust: Mitigating Follina](https://www.beyondtrust.com)
- [BlackBerry: Follina Vulnerability](https://www.blackberry.com)

---

## Credits

Lab developed by **Retr0duck**.  
Original repository: [cybersecurity-labs](https://github.com/Retr0duck/cybersecurity-labs)

---

## License

This laboratory is for educational use. See the LICENSE file for more details.
